<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paichi.modules.recipeOrders.mapper.UserOrdersMapper">

    <resultMap id="userOrders" type="com.paichi.modules.recipeOrders.entity.UserOrders">
        <id property="userOrdersId" column="USER_ORDERS_ID"></id>
        <result property="userId" column="USER_ID"></result>
        <result property="userOrdersTitle" column="USER_ORDERS_TITLE"></result>
        <result property="userOrdersContent" column="USER_ORDERS_CONTENT"></result>
        <result property="popularity" column="POPULARITY"></result>
        <result property="likes" column="LIKES"></result>
        <result property="lastUpdateDate" column="LAST_UPDATE_DATE"></result>
        <result property="createTime" column="CREATE_TIME"></result>
        <!--多对多关联关系-->
        <collection property="recipes" ofType="com.paichi.modules.recipe.entity.Recipe">
            <id property="recipeId" column="RECIPE_ID"></id>
            <result property="recipeName" column="RECIPE_NAME"></result>
            <result property="recipeImg" column="RECIPE_IMG"></result>
            <result property="recipeVideo" column="RECIPE_VIDEO"></result>
            <result property="craftId" column="CRAFT_ID"></result>
            <result property="userId" column="USER_ID"></result>
            <result property="peopleNumber" column="PEOPLE_NUMBER"></result>
            <result property="cookTime" column="COOK_TIME"></result>
            <result property="preparationTime" column="PREPARATION_TIME"></result>
            <result property="popularity" column="POPULARITY"></result>
            <result property="difficulty" column="DIFFICULTY"></result>
            <result property="introduction" column="INTRODUCTION"></result>
            <result property="cookingSkill" column="COOKINGSKILL"></result>
            <result property="timestamp" column="TIMESTAMP"></result>
        </collection>
    </resultMap>

    <!--获取用户菜单-->
    <select id="getUserOrder" parameterType="String" resultType="UserOrders">
        select USER_ORDERS_ID, USER_ID, USER_ORDERS_TITLE, USER_ORDERS_CONTENT,
               POPULARITY, LIKES, LAST_UPDATE_DATE, CREATE_TIME
        from USER_ORDERS
        where USER_ID = #{userId}
    </select>

    <!--查看用户是否已经收藏过该食谱-->
    <select id="getUserCollectionByRecipeId" resultType="OrdersRecipe">
        select *
        from ORDERS_RECIPE
        where USER_ORDERS_ID = (select USER_ORDERS_ID from USER_ORDERS where USER_ID = #{userId})
          and RECIPE_ID = #{recipeId}
    </select>

    <!--从食谱菜单中移除食谱(取消收藏)-->
    <delete id="removeRecipeFromCollections" parameterType="Integer">
        delete ORDERS_RECIPE
        where ORDERS_RECIPE_ID = #{ordersRecipeId}
    </delete>

    <!--创建用户菜单-->
    <insert id="insertUserOrder" parameterType="UserOrders">
        insert into
        USER_ORDERS
        <trim prefix="(" suffix=")" suffixOverrides=",">
            USER_ORDERS_ID,
            USER_ID,
            <if test="userOrdersTitle != null and userOrdersTitle != ''">
                USER_ORDERS_TITLE,
            </if>
            <if test="userOrdersContent != null and userOrdersContent != ''">
                USER_ORDERS_CONTENT,
            </if>
            <if test="popularity != null">
                POPULARITY,
            </if>
            <if test="likes != null">
                LIKES,
            </if>
            LAST_UPDATE_DATE,
            CREATE_TIME
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            #{userOrdersId},
            #{userId},
            <if test="userOrdersTitle != null and userOrdersTitle != ''">
                #{userOrdersTitle},
            </if>
            <if test="userOrdersContent != null and userOrdersContent != ''">
                #{userOrdersContent},
            </if>
            <if test="popularity != null">
                #{popularity, jdbcType=NUMERIC},
            </if>
            <if test="likes != null">
                #{likes, jdbcType=NUMERIC},
            </if>
            #{lastUpdateDate},
            #{createTime}
        </trim>
    </insert>
</mapper>
